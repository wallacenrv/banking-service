<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AgenciaService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">banking-service</a> &gt; <a href="index.source.html" class="el_package">br.com.alura.service</a> &gt; <span class="el_source">AgenciaService.java</span></div><h1>AgenciaService.java</h1><pre class="source lang-java linenums">package br.com.alura.service;

import br.com.alura.domain.Agencia;
import br.com.alura.exception.AgenciaNaoEncontradaException;
import br.com.alura.repository.AgenciaRepository;
import br.com.alura.service.http.AgenciaNaoAtivaOuNaoEncontradaException;
import br.com.alura.service.http.SituacaoCadastral;
import br.com.alura.service.http.SituacaoCadastralHttpService;
import io.quarkus.logging.Log;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.inject.Inject;
import org.eclipse.microprofile.rest.client.inject.RestClient;


@ApplicationScoped // quarkus gerenciq para mim para que eu use
public class AgenciaService {

    @Inject
    @RestClient // Injeta o cliente REST configurado para acessar a API externa de situação cadastral
    private SituacaoCadastralHttpService situacaoCadastralHttpService;

    private final AgenciaRepository agenciaRepository;

    @Inject
<span class="fc" id="L25">    public AgenciaService(AgenciaRepository agenciaRepository) {</span>
<span class="fc" id="L26">        this.agenciaRepository = agenciaRepository;</span>
<span class="fc" id="L27">    }</span>


    public void cadastrar(Agencia agencia) {
<span class="fc" id="L31">        Agencia agenciaBuscada = situacaoCadastralHttpService.buscarPorCnpj(agencia.getCnpj());</span>


<span class="pc bpc" id="L34" title="2 of 4 branches missed.">        if (agenciaBuscada != null &amp;&amp; SituacaoCadastral.ATIVO.equals(agenciaBuscada.getSituacaoCadastral())) {</span>
<span class="nc" id="L35">            Log.info(&quot;Agencia com CNPJ &quot; + agencia.getCnpj() + &quot; foi cadastrada com sucesso.&quot;);</span>
<span class="nc" id="L36">            agenciaRepository.persist(agencia);</span>
        }
<span class="pc bpc" id="L38" title="2 of 4 branches missed.">        else if (agenciaBuscada != null &amp;&amp; SituacaoCadastral.INATIVO.equals(agenciaBuscada.getSituacaoCadastral()))  {</span>
<span class="fc" id="L39">            throw  new AgenciaNaoAtivaOuNaoEncontradaException(&quot;Agencia inativa não pode ser cadastrada.&quot;);</span>
        }
        else {
<span class="nc" id="L42">            Log.info(&quot;Agencia com CNPF &quot; + agencia.getCnpj() + &quot; não foi cadastrada.&quot;);</span>
<span class="nc" id="L43">            throw new AgenciaNaoEncontradaException(&quot;Agência com CNPJ &quot; + agencia.getCnpj() + &quot; não está ativa.&quot;);</span>
        }


<span class="nc" id="L47">    }</span>


    public Agencia buscarPorId(Long id) {
<span class="nc" id="L51">        Agencia agenciaBuscada = agenciaRepository.findById(id);</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">        if (agenciaBuscada == null) {</span>
<span class="nc" id="L53">            throw new AgenciaNaoEncontradaException(&quot;Agência com ID &quot; + id + &quot; não encontrada.&quot;);</span>
        }
<span class="nc" id="L55">        return agenciaBuscada;</span>
    }

    public void deletar(Long id) {
<span class="nc" id="L59">        Agencia agenciaExistente = buscarPorId(id);</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">        if (agenciaExistente != null) {</span>
<span class="nc" id="L61">            Log.info(&quot;Agencia com ID &quot; + id + &quot; foi deletada com sucesso.&quot;);</span>
<span class="nc" id="L62">            agenciaRepository.delete(agenciaExistente);</span>
        } else {
<span class="nc" id="L64">            throw new AgenciaNaoEncontradaException(&quot;Agência com ID : &quot; + id + &quot; não encontrada.&quot;);</span>
        }
<span class="nc" id="L66">    }</span>

    public void alterar(Agencia agencia) {
        // Busca a entidade pelo ID
<span class="nc" id="L70">        Agencia entidadeExistente = agenciaRepository.findById(agencia.getId());</span>

<span class="nc bnc" id="L72" title="All 2 branches missed.">        if (entidadeExistente != null) {</span>
            // Atualiza os atributos desejados
<span class="nc" id="L74">            entidadeExistente.setNome(agencia.getNome());</span>
<span class="nc" id="L75">            entidadeExistente.setRazaoSocial(agencia.getRazaoSocial());</span>
<span class="nc" id="L76">            entidadeExistente.setCnpj(agencia.getCnpj());</span>
<span class="nc" id="L77">            Log.info(&quot;Agencia com ID &quot; + agencia.getId() + &quot; foi alterada com sucesso.&quot;);</span>
        } else {
<span class="nc" id="L79">            Log.info(&quot;Agencia não foi alterada&quot;);</span>
<span class="nc" id="L80">            throw new IllegalStateException(&quot;Agência com ID &quot; + agencia.getId() + &quot; não encontrada&quot;);</span>
        }
<span class="nc" id="L82">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>